<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=9" >

<title>Project1Part1.R</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<!-- Automatically generated by RStudio [12861c30b10411e1afa60800200c9a66] -->

<h3>Project1Part1.R</h3>

<p>Chad W. Dunham &mdash; <em>Feb 28, 2014, 3:18 PM</em></p>

<pre><code class="r">#Project 1 - Part I
#Chad W. Dunham

#Naive Bayes Spam Classifier - This algorithm looks for words that are 
#noticeably more likely to occur in spam messages or noticeably more likely to 
#occur in ham messages for many words.  To do this, the algorithm &quot;[computes] 
#the probability of seeing the exact contents of an email conditioned on the 
#email being assumed to be spam, and . . . the probability of seeing the same 
#email&#39;s contents conditioned on the email being assumed to be ham.



#Importing needed packages
#install.packages(&quot;tm&quot;, repos=&quot;http://cran.mtu.edu/&quot;)
library(tm)
library(ggplot2)


#Setting paths for files
spam.path = &quot;data/spam/&quot;
spam2.path = &quot;data/spam_2/&quot;
easyham.path = &quot;data/easy_ham/&quot;
easyham2.path = &quot;data/easy_ham_2/&quot;
hardham.path = &quot;data/hard_ham/&quot;
hardham2.path = &quot;data/hard_ham_2/&quot;


# Creating the &quot;motivating plot&quot;... note this is not really part of the 
#classifier but is included in the author&#39;s code.
x &lt;- runif(1000, 0, 40)
y1 &lt;- cbind(runif(100, 0, 10), 1)
y2 &lt;- cbind(runif(800, 10, 30), 2)
y3 &lt;- cbind(runif(100, 30, 40), 1)

val &lt;- data.frame(cbind(x, rbind(y1, y2, y3)),
                  stringsAsFactors = TRUE)

ex1 &lt;- ggplot(val, aes(x, V2)) +
  geom_jitter(aes(shape = as.factor(V3)),
              position = position_jitter(height = 2)) +
  scale_shape_discrete(guide = &quot;none&quot;, solid = FALSE) +
  geom_hline(aes(yintercept = c(10,30)), linetype = 2) +
  theme_bw() +
  xlab(&quot;X&quot;) +
  ylab(&quot;Y&quot;)
ggsave(plot = ex1,
       filename = file.path(&quot;images&quot;, &quot;00_Ex1.pdf&quot;),
       height = 10,
       width = 10)

#Text-mining function
get.msg = function(path) {
  con = file(path, open=&quot;rt&quot;, encoding=&quot;native.enc&quot;) 
  #This is changed to correspond with the errata fixes in the book
  text = readLines(con)
  msg = text[seq(which(text==&quot;&quot;)[1]+1, length(text), 1)]
  #Above edited to include update code from authors
  close(con)
  return(paste(msg, collapse=&quot;\n&quot;))
}


#Retrieving the messages from all of the spam and ham emails
spam.docs = dir(spam.path)
spam.docs = spam.docs[which(spam.docs!=&quot;cmds&quot;)]
all.spam = sapply(spam.docs, function(p) get.msg(paste(spam.path, p, sep=&quot;&quot;)))



#Creating the Term Document Matrix
get.tdm = function(doc.vec)  {
  doc.corpus = Corpus(VectorSource(doc.vec))
  control = list(stopwords=TRUE, removePunctuation=TRUE, removeNumbers=TRUE, minDocFreq=2)
  doc.dtm = TermDocumentMatrix(doc.corpus, control)
  return(doc.dtm)
}
spam.tdm = get.tdm(all.spam)


#Building TDM training data
spam.matrix = as.matrix(spam.tdm)
spam.counts = rowSums(spam.matrix)
spam.df = data.frame(cbind(names(spam.counts), as.numeric(spam.counts)), stringsAsFactors=FALSE)
names(spam.df) = c(&quot;term&quot;, &quot;frequency&quot;)
spam.df$frequency = as.numeric(spam.df$frequency)

#Generating training data
spam.occurrence = sapply(1:nrow(spam.matrix), function(i) {length(which(spam.matrix[i,] &gt; 0))/ncol(spam.matrix)})
spam.density = spam.df$frequency/sum(spam.df$frequency)

#Adding the training data to the original data frame
spam.df = transform(spam.df, density=spam.density, occurrence=spam.occurrence)

head(spam.df[with(spam.df, order(-occurrence)),]) #Summary printout from book
</code></pre>

<pre><code>        term frequency  density occurrence
7743   email       813 0.005858     0.5671
18751 please       425 0.003062     0.5090
14673   list       409 0.002947     0.4449
27261   will       828 0.005966     0.4228
3004    body       379 0.002731     0.4088
9413    free       539 0.003884     0.3908
</code></pre>

<pre><code class="r">


#REDOING ABOVE FOR EASY HAM
#Retrieving the messages from all of the spam and ham emails
easyham.docs = dir(easyham.path)
easyham.docs = easyham.docs[which(easyham.docs!=&quot;cmds&quot;)]
all.easyham = sapply(easyham.docs, function(p) get.msg(paste(easyham.path, p, sep=&quot;&quot;)))
#Running the Term Document Matrix (using previously created function)
easyham.tdm = get.tdm(all.easyham)
#Building TDM training data
easyham.matrix = as.matrix(easyham.tdm)
easyham.counts = rowSums(easyham.matrix)
easyham.df = data.frame(cbind(names(easyham.counts), as.numeric(easyham.counts)), stringsAsFactors=FALSE)
names(easyham.df) = c(&quot;term&quot;, &quot;frequency&quot;)
easyham.df$frequency = as.numeric(easyham.df$frequency)
#Generating training data
easyham.occurrence = sapply(1:nrow(easyham.matrix), function(i) {length(which(easyham.matrix[i,] &gt; 0))/ncol(easyham.matrix)})
easyham.density = easyham.df$frequency/sum(easyham.df$frequency)
#Adding the training data to the original data frame
easyham.df = transform(easyham.df, density=easyham.density, occurrence=easyham.occurrence)

head(easyham.df[with(easyham.df, order(-occurrence)),]) #Summary printout from book
</code></pre>

<pre><code>         term frequency  density occurrence
16171    list      1285 0.004530     0.3732
3536      can      1527 0.005383     0.3188
6023     date       836 0.002947     0.3116
30173   wrote       921 0.003247     0.3072
15181    just      1211 0.004269     0.3008
16648 mailing       822 0.002898     0.2944
</code></pre>

<pre><code class="r">


#Setting up the email classifier function
classify.email = function(path, training.df, prior=.5, c=1e-6)  {
  msg = get.msg(path)
  msg.tdm = get.tdm(msg)
  msg.freq = rowSums(as.matrix(msg.tdm))
  msg.match = intersect(names(msg.freq), training.df$term)
  if(length(msg.match) &lt; 1) {
    return(prior*c^(length(msg.freq)))
  }
  else {
    match.probs = training.df$occurrence[match(msg.match, training.df$term)]
    return(prior * prod(match.probs) * c^(length(msg.freq)-length(msg.match)))
  }
}


#Testing the classifier on hard ham
hardham.docs = dir(hardham.path)
hardham.docs = hardham.docs[which(hardham.docs != &quot;cmds&quot;)]

hardham.spamtest = sapply(hardham.docs, function(p) classify.email(paste(hardham.path, p, sep=&quot;/&quot;), training.df = spam.df))

hardham.hamtest = sapply(hardham.docs, function(p) classify.email(paste(hardham.path, p, sep=&quot;/&quot;), training.df = easyham.df))

hardham.res = ifelse(hardham.spamtest &gt; hardham.hamtest, FALSE, TRUE)
summary(hardham.res)
</code></pre>

<pre><code>   Mode   FALSE    TRUE    NA&#39;s 
logical       3     246       0 
</code></pre>

<pre><code class="r">


#Testing the classifier against all types of emails
spam.classifier = function(path)  {
  pr.spam = classify.email(path, spam.df)
  pr.ham = classify.email(path, easyham.df)
  return(c(pr.spam, pr.ham, ifelse(pr.spam &gt; pr.ham, 1, 0)))
}

# Getting the lists of all the email messages
easyham2.docs &lt;- dir(easyham2.path)
easyham2.docs &lt;- easyham2.docs[which(easyham2.docs != &quot;cmds&quot;)]

hardham2.docs &lt;- dir(hardham2.path)
hardham2.docs &lt;- hardham2.docs[which(hardham2.docs != &quot;cmds&quot;)]

spam2.docs &lt;- dir(spam2.path)
spam2.docs &lt;- spam2.docs[which(spam2.docs != &quot;cmds&quot;)]


# Classifying all of the classes of emails
easyham2.class &lt;- suppressWarnings(lapply(easyham2.docs,
                                          function(p)
                                          {
                                            spam.classifier(file.path(easyham2.path, p))
                                          }))
hardham2.class &lt;- suppressWarnings(lapply(hardham2.docs,
                                          function(p)
                                          {
                                            spam.classifier(file.path(hardham2.path, p))
                                          }))
spam2.class &lt;- suppressWarnings(lapply(spam2.docs,
                                       function(p)
                                       {
                                         spam.classifier(file.path(spam2.path, p))
                                       }))

# Create a single, final, data frame with all of the classification data in it
easyham2.matrix &lt;- do.call(rbind, easyham2.class)
easyham2.final &lt;- cbind(easyham2.matrix, &quot;EASYHAM&quot;)

hardham2.matrix &lt;- do.call(rbind, hardham2.class)
hardham2.final &lt;- cbind(hardham2.matrix, &quot;HARDHAM&quot;)

spam2.matrix &lt;- do.call(rbind, spam2.class)
spam2.final &lt;- cbind(spam2.matrix, &quot;SPAM&quot;)

class.matrix &lt;- rbind(easyham2.final, hardham2.final, spam2.final)
class.df &lt;- data.frame(class.matrix, stringsAsFactors = FALSE)
names(class.df) &lt;- c(&quot;Pr.SPAM&quot; ,&quot;Pr.HAM&quot;, &quot;Class&quot;, &quot;Type&quot;)
class.df$Pr.SPAM &lt;- as.numeric(class.df$Pr.SPAM)
class.df$Pr.HAM &lt;- as.numeric(class.df$Pr.HAM)
class.df$Class &lt;- as.logical(as.numeric(class.df$Class))
class.df$Type &lt;- as.factor(class.df$Type)

head(class.df)
</code></pre>

<pre><code>     Pr.SPAM     Pr.HAM Class    Type
1  0.000e+00  0.000e+00 FALSE EASYHAM
2 5.806e-248 8.991e-141 FALSE EASYHAM
3  0.000e+00 2.022e-199 FALSE EASYHAM
4  0.000e+00  0.000e+00 FALSE EASYHAM
5 2.198e-169  3.112e-97 FALSE EASYHAM
6  0.000e+00  0.000e+00 FALSE EASYHAM
</code></pre>

<pre><code class="r">
#Matrix of classifier results

# Creating a final plot of results
class.plot &lt;- ggplot(class.df, aes(x = log(Pr.HAM), log(Pr.SPAM))) +
  geom_point(aes(shape = Type, alpha = 0.5)) +
  stat_abline(yintercept = 0, slope = 1) +
  scale_shape_manual(values = c(&quot;EASYHAM&quot; = 1,
                                &quot;HARDHAM&quot; = 2,
                                &quot;SPAM&quot; = 3),
                     name = &quot;Email Type&quot;) +
  scale_alpha(guide = &quot;none&quot;) +
  xlab(&quot;log[Pr(HAM)]&quot;) +
  ylab(&quot;log[Pr(SPAM)]&quot;) +
  theme_bw() +
  theme(axis.text.x = element_blank(), axis.text.y = element_blank())
ggsave(plot = class.plot, filename = file.path(&quot;images&quot;, &quot;03_final_classification.pdf&quot;),
       height = 10,
       width = 10)

get.results &lt;- function(bool.vector)
{
  results &lt;- c(length(bool.vector[which(bool.vector == FALSE)]) / length(bool.vector),
               length(bool.vector[which(bool.vector == TRUE)]) / length(bool.vector))
  return(results)
}

# Saving the results as a 2x3 table
easyham2.col &lt;- get.results(subset(class.df, Type == &quot;EASYHAM&quot;)$Class)
hardham2.col &lt;- get.results(subset(class.df, Type == &quot;HARDHAM&quot;)$Class)
spam2.col &lt;- get.results(subset(class.df, Type == &quot;SPAM&quot;)$Class)

class.res &lt;- rbind(easyham2.col, hardham2.col, spam2.col)
colnames(class.res) &lt;- c(&quot;NOT SPAM&quot;, &quot;SPAM&quot;)
print(class.res)
</code></pre>

<pre><code>             NOT SPAM    SPAM
easyham2.col   0.9893 0.01071
hardham2.col   0.9839 0.01613
spam2.col      0.4875 0.51253
</code></pre>

<pre><code class="r">
#END OF CODE
</code></pre>

</body>

</html>

